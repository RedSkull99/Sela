{% extends "master.html" %}

{% block title %}Order Details #{{ order.id }}{% endblock %}

{% block content %}
<div class="result-card" style="max-width: 800px; text-align: left;">
    <div
        style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 2rem; border-bottom: 1px solid #e2e8f0; padding-bottom: 1rem;">
        <div>
            <h2>Order #{{ order.id }}</h2>
            <p style="color: var(--text-light);">Placed on {{ order.date_ordered.strftime('%B %d, %Y at %H:%M') }}</p>
        </div>
        <div style="text-align: right;">
            <p style="font-size: 0.9rem; margin-bottom: 0.5rem;">Status</p>
            <form action="{{ url_for('admin.order_details', id=order.id) }}" method="POST"
                style="display: inline-block;">
                <select name="status" onchange="this.form.submit()"
                    style="padding: 0.4rem; border-radius: var(--radius-lg); border: 1px solid #cbd5e1;">
                    <option value="Pending" {% if order.status=='Pending' %}selected{% endif %}>Pending</option>
                    <option value="Processing" {% if order.status=='Processing' %}selected{% endif %}>Processing
                    </option>
                    <option value="Shipped" {% if order.status=='Shipped' %}selected{% endif %}>Shipped</option>
                    <option value="Completed" {% if order.status=='Completed' %}selected{% endif %}>Completed</option>
                    <option value="Cancelled" {% if order.status=='Cancelled' %}selected{% endif %}>Cancelled</option>
                </select>
            </form>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 3rem;">
        <div>
            <h3>Customer Details</h3>
            <p><strong>Name:</strong> {{ order.user.name }}</p>
            <p><strong>Email:</strong> {{ order.user.email }}</p>
        </div>
        <div>
            <h3>Order Summary</h3>
            <p><strong>Total Items:</strong> {{ order.items|length }}</p>
            <p><strong>Total Price:</strong> <span
                    style="font-size: 1.25rem; color: var(--primary); font-weight: 700;">${{ order.total_price }}</span>
            </p>
        </div>
    </div>

    <h3>Ordered Items</h3>
    <table>
        <thead>
            <tr>
                <th>Product</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Subtotal</th>
            </tr>
        </thead>
        <tbody>
            {% for item in order.items %}
            <tr>
                <td>{{ item.product.name }}</td>
                <td>${{ item.price }}</td>
                <td>{{ item.quantity }}</td>
                <td>${{ item.price * item.quantity }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div style="margin-top: 2rem;">
        <a href="{{ url_for('admin.orders') }}" class="btn-secondary">Back to Orders</a>
    </div>
</div>
{% endblock %}